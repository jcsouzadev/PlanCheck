<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Ordem de Serviço #{{ ordem.id }}</title>
    <style>
        /* ========================================================================= */
        /* DEFINIÇÕES DE PÁGINA A4 (WeasyPrint / CSS Paged Media) */
        /* ========================================================================= */
        @page {
            size: A4;
            /* Margens padrão para documentos formais */
            margin-top: 2cm; 
            margin-bottom: 2cm;
            margin-left: 1.5cm;
            margin-right: 1.5cm;
            
            /* Definição de rodapé fixo */
            @bottom-center {
                content: "Página " counter(page) " de " counter(pages) " | PlanCheck | Gerado em {{ data_geracao.strftime('%d/%m/%Y %H:%M') }}";
                font-family: Arial, sans-serif;
                font-size: 8pt;
                color: #555;
            }
        }

        /* Força a seção de assinaturas para a próxima página */
        #assinaturas-page-break {
            page-break-before: always;
            margin-top: 5cm; /* Adiciona espaço extra na nova página */
        }
        
        /* ========================================================================= */
        /* ESTILIZAÇÃO GERAL */
        /* ========================================================================= */
        body {
            font-family: Arial, sans-serif;
            font-size: 10pt;
            color: #333;
            line-height: 1.4;
        }

        .header-main {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 4px solid #295673; /* Cor institucional */
            padding-bottom: 5px;
            margin-bottom: 15px;
        }
        
        .header-main .logo {
            font-size: 18pt;
            font-weight: bold;
            color: #295673;
        }
        
        .header-main .title-box {
            text-align: right;
            border: 1px solid #295673;
            padding: 5px 10px;
            background-color: #f0f0f0;
        }
        
        .header-main .title-box h1 {
            margin: 0;
            font-size: 14pt;
            color: #295673;
        }
        
        .header-main .title-box p {
            margin: 0;
            font-size: 10pt;
        }

        /* ========================================================================= */
        /* DETALHES DA ORDEM (GRID FLEXÍVEL) */
        /* ========================================================================= */
        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr; /* Três colunas iguais */
            gap: 10px;
            margin-bottom: 20px;
            padding: 10px;
            background-color: #f9f9f9;
            border: 1px solid #eee;
        }
        
        .info-item {
            padding: 5px;
        }
        
        .info-item strong {
            display: block;
            color: #555;
            font-size: 8pt;
            margin-bottom: 2px;
        }
        
        .info-item span {
            display: block;
            font-size: 10pt;
            font-weight: bold;
            color: #222;
        }

        /* ========================================================================= */
        /* TABELA DE ITENS APONTADOS */
        /* ========================================================================= */
        .table-os {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .table-os th, .table-os td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: left;
            font-size: 9pt;
        }
        
        .table-os th {
            background-color: #295673;
            color: white;
            font-weight: bold;
            text-transform: uppercase;
        }

        /* Estilos específicos para resultados importantes */
        .nao_conforme {
            background-color: #ffcccc; 
            font-weight: bold;
            color: #900;
        }
        
        .conforme {
            background-color: #ccffcc;
            color: #060;
        }

        /* ========================================================================= */
        /* ASSINATURAS */
        /* ========================================================================= */
        .assinaturas {
            margin-top: 50px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 50px;
            width: 80%;
            margin-left: 10%;
        }
        
        .assinatura-box {
            text-align: center;
            padding-top: 20px;
            border-top: 1px solid #333;
        }
        
        .assinatura-box p {
            margin: 0;
            font-size: 10pt;
        }
    </style>
</head>
<body>

    <header class="header-main">
        <div class="logo">
            PlanCheck
        </div>
        <div class="title-box">
            <h1>ORDEM DE SERVIÇO DE INSPEÇÃO</h1>
            <p>Nº: {{ ordem.id }}</p>
        </div>
    </header>

    <div class="info-grid">
        <div class="info-item">
            <strong>Plano de Inspeção</strong>
            <span>{{ ordem.plano.titulo if ordem.plano else 'N/A' }}</span>
        </div>
        <div class="info-item">
            <strong>Equipamento (Código)</strong>
            <span>{{ ordem.plano.equipamento.nome if ordem.plano and ordem.plano.equipamento else 'N/A' }} ({{ ordem.plano.equipamento.codigo if ordem.plano and ordem.plano.equipamento else '-' }})</span>
        </div>
        <div class="info-item">
            <strong>Localização</strong>
            <span>{{ ordem.plano.equipamento.subconjunto.conjunto.area.setor.empresa.nome|upper if ordem.plano and ordem.plano.equipamento else 'N/A' }}</span>
        </div>
        
        <div class="info-item">
            <strong>Executante Programado</strong>
            <span>{{ ordem.executante.nome|upper if ordem.executante else 'N/A' }} ({{ ordem.executante.matricula if ordem.executante else '-' }})</span>
        </div>
        <div class="info-item">
            <strong>Data Programada</strong>
            <span>{{ ordem.data_programada.strftime('%d/%m/%Y') if ordem.data_programada else '-' }}</span>
        </div>
        <div class="info-item">
            <strong>Status / Conclusão</strong>
            <span>
                {% if ordem.status == 'concluida' %}
                    CONCLUÍDA em {{ ordem.data_conclusao.strftime('%d/%m/%Y às %H:%M') if ordem.data_conclusao else 'data N/A' }}
                {% else %}
                    {{ ordem.status|upper }}
                {% endif %}
            </span>
        </div>
    </div>
    
    <h2>Itens de Inspeção e Apontamentos</h2>

    <table class="table-os">
        <thead>
            <tr>
                <th style="width: 30%;">Descrição do Item / Tipo</th>
                <th style="width: 10%;">Resultado</th>
                <th style="width: 10%;">Valor (Min/Max)</th>
                <th style="width: 25%;">Observação / Falha Apontada</th>
                <th style="width: 25%;">Solução / Recursos Utilizados</th>
            </tr>
        </thead>
        <tbody>
            {% for apontamento in ordem.itens_apontados %}
            <tr>
                <td>
                    <strong>{{ apontamento.item_inspecao.descricao }}</strong><br>
                    <small>Tipo: {{ apontamento.item_inspecao.tipo|upper if apontamento.item_inspecao.tipo else 'Visual' }}</small>
                </td>

                <td class="{{ apontamento.resultado|lower if apontamento.resultado else 'pendente' }}">
                    {{ apontamento.resultado|upper if apontamento.resultado else 'PENDENTE' }}
                </td>
                
                <td>
                    {% if apontamento.valor_atual %}
                        **Medido:** {{ apontamento.valor_atual }}<br>
                    {% endif %}
                    {% if apontamento.item_inspecao.valor_min or apontamento.item_inspecao.valor_max %}
                        <small>Ref: ({{ apontamento.item_inspecao.valor_min or '-' }} / {{ apontamento.item_inspecao.valor_max or '-' }})</small>
                    {% else %}
                        -
                    {% endif %}
                </td>

                <td>
                    {% if apontamento.falha %}
                        **FALHA:** {{ apontamento.falha }}<br>
                    {% endif %}
                    {% if apontamento.observacao %}
                        **OBS:** {{ apontamento.observacao }}
                    {% endif %}
                </td>

                <td>
                    {% if apontamento.solucao %}
                        **SOLUÇÃO:** {{ apontamento.solucao }}
                        <hr style="border: 0; border-top: 1px dashed #ccc; margin: 5px 0;">
                        **Tempo (h):** {{ apontamento.tempo_necessario or '-' }} | **Qtd. Executantes:** {{ apontamento.qtde_executantes or '-' }}<br>
                        **Materiais:** {{ apontamento.materiais or '-' }}
                    {% else %}
                        -
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <div id="assinaturas-page-break">
        <h2 style="text-align: center;">Registro e Aprovação</h2>
        
        <div class="info-grid" style="grid-template-columns: 1fr 1fr; margin-bottom: 50px; border: none; background-color: white;">
            <div class="info-item">
                <strong>Data de Início da Execução</strong>
                <span>_________________________</span>
            </div>
            <div class="info-item">
                <strong>Data de Término da Execução</strong>
                <span>_________________________</span>
            </div>
        </div>

        <div class="assinaturas">
            <div class="assinatura-box">
                <p>{{ ordem.executante.nome|upper if ordem.executante else 'N/A' }}</p>
                <p>Executante (Assinatura e Matrícula)</p>
            </div>
            <div class="assinatura-box">
                <p>_________________________</p>
                <p>Supervisor / Inspetor (Assinatura e Matrícula)</p>
            </div>
        </div>
    </div>
    
</body>
</html>