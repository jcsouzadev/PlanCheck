<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Ordem de Serviço Nº {{ ordem.id }}</title>
    <style>
        @page {
            size: A4;
            margin: 2cm;
        }
        
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            margin: 0;
            padding: 0;
            font-size: 11pt;
            line-height: 1.4;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 3px solid #295673;
        }
        
        .header h1 {
            color: #295673;
            margin: 0 0 5px 0;
            font-size: 24pt;
        }
        
        .header .empresa {
            color: #6c757d;
            font-size: 12pt;
            font-weight: 500;
        }
        
        .info-box {
            background-color: #F2EBF3;
            padding: 15px;
            margin: 20px 0;
            border-left: 5px solid #295673;
            border-radius: 4px;
        }
        
        .info-box p {
            margin: 5px 0;
            font-size: 10pt;
        }
        
        .info-box strong {
            color: #495057;
            min-width: 140px;
            display: inline-block;
        }
        
        h2 {
            color: #295673;
            font-size: 14pt;
            margin-top: 25px;
            margin-bottom: 10px;
            border-bottom: 2px solid #C7D7E4;
            padding-bottom: 5px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            font-size: 9pt;
        }
        
        th, td {
            border: 1px solid #dee2e6;
            padding: 8px;
            text-align: left;
            vertical-align: top;
        }
        
        th {
            background-color: #295673;
            color: white;
            font-weight: 600;
            font-size: 9pt;
        }
        
        .conforme {
            background-color: rgba(122, 173, 107, 0.2);
        }
        
        .nao-conforme {
            background-color: #f8d7da;
        }
        
        .na {
            background-color: rgba(199, 215, 228, 0.3);
        }
        
        .footer {
            margin-top: 30px;
            padding-top: 15px;
            border-top: 1px solid #dee2e6;
            text-align: center;
            font-size: 8pt;
            color: #6c757d;
        }
        
        .ref-values {
            color: #295673;
            font-size: 8pt;
            font-style: italic;
            display: block;
            margin-top: 3px;
        }
        
        .status-badge {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 9pt;
            font-weight: 600;
        }
        
        .status-concluida {
            background-color: rgba(122, 173, 107, 0.3);
            color: #3d6835;
        }
        
        .status-pendente {
            background-color: #fff3cd;
            color: #664d03;
        }
        
        .status-em-andamento {
            background-color: rgba(41, 86, 115, 0.2);
            color: #295673;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Ordem de Serviço Nº {{ ordem.id }}</h1>
        {% if ordem.plano and ordem.plano.equipamento and ordem.plano.equipamento.subconjunto and ordem.plano.equipamento.subconjunto.conjunto and ordem.plano.equipamento.subconjunto.conjunto.area and ordem.plano.equipamento.subconjunto.conjunto.area.setor and ordem.plano.equipamento.subconjunto.conjunto.area.setor.empresa %}
        <div class="empresa">{{ ordem.plano.equipamento.subconjunto.conjunto.area.setor.empresa.nome }}</div>
        {% endif %}
    </div>
    
    <div class="info-box">
        <p><strong>Plano de Inspeção:</strong> {{ ordem.plano.titulo }}</p>
        <p><strong>Equipamento:</strong> {{ ordem.plano.equipamento.nome }}</p>
        {% if ordem.plano.equipamento.codigo %}
        <p><strong>Código:</strong> {{ ordem.plano.equipamento.codigo }}</p>
        {% endif %}
        <p><strong>Executante:</strong> {{ ordem.executante.username }}</p>
        <p><strong>Data Programada:</strong> {{ ordem.data_programada.strftime('%d/%m/%Y') }}</p>
        <p><strong>Status:</strong> 
            <span class="status-badge status-{{ ordem.status.lower().replace(' ', '-') }}">
                {{ ordem.status.upper() }}
            </span>
        </p>
        {% if ordem.data_conclusao %}
        <p><strong>Data de Conclusão:</strong> {{ ordem.data_conclusao.strftime('%d/%m/%Y às %H:%M') }}</p>
        {% endif %}
    </div>

    <h2>Itens Apontados</h2>
    <table>
        <thead>
            <tr>
                <th style="width: 5%;">#</th>
                <th style="width: 25%;">Item</th>
                <th style="width: 10%;">Tipo</th>
                <th style="width: 10%;">Resultado</th>
                <th style="width: 10%;">Valor Medido</th>
                <th style="width: 15%;">Observação</th>
                <th style="width: 12.5%;">Falha</th>
                <th style="width: 12.5%;">Solução</th>
            </tr>
        </thead>
        <tbody>
            {% for apontamento in ordem.itens_apontados %}
            <tr class="{% if apontamento.resultado == 'conforme' %}conforme{% elif apontamento.resultado == 'nao_conforme' %}nao-conforme{% else %}na{% endif %}">
                <td>{{ loop.index }}</td>
                <td>
                    <strong>{{ apontamento.item_inspecao.descricao }}</strong>
                    {% if apontamento.item_inspecao.tipo == 'medicoes' and (apontamento.item_inspecao.valor_min or apontamento.item_inspecao.valor_max) %}
                    <span class="ref-values">
                        Ref: Min {{ apontamento.item_inspecao.valor_min if apontamento.item_inspecao.valor_min else '-' }} | 
                        Max {{ apontamento.item_inspecao.valor_max if apontamento.item_inspecao.valor_max else '-' }}
                    </span>
                    {% endif %}
                </td>
                <td>{{ apontamento.item_inspecao.tipo|title if apontamento.item_inspecao.tipo else '-' }}</td>
                <td>{{ apontamento.resultado|title if apontamento.resultado else '-' }}</td>
                <td>{{ apontamento.valor_atual if apontamento.valor_atual else '-' }}</td>
                <td>{{ apontamento.observacao if apontamento.observacao else '-' }}</td>
                <td>{{ apontamento.falha if apontamento.falha else '-' }}</td>
                <td>{{ apontamento.solucao if apontamento.solucao else '-' }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <div class="footer">
        <p>Relatório gerado em {{ ordem.data_conclusao.strftime('%d/%m/%Y às %H:%M') if ordem.data_conclusao else 'processamento' }} - PlanCheck Sistema de Gestão de Manutenção</p>
    </div>
</body>
</html>
